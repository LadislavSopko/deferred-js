(function(a){function c(b){if(this===a)return new c;this.doneFuncs=[],this.failFuncs=[],this.resultArgs=null,this.status="",b&&b.apply(this,[this])}function b(a,b,c){return function(){if(c){a.apply(b,arguments);return c}return a.apply(b,arguments)}}c.when=function(){if(arguments.length<2){var a=arguments.length?arguments[0]:undefined;return a&&typeof a.isResolved=="function"&&typeof a.isRejected=="function"?a.promise():c().resolve(a).promise()}return function(a){var b=c(),d=a.length,e=0,f=Array(d);for(var g=0;g<a.length;g++)(function(c){a[c].done(function(){f[c]=arguments.length<2?arguments[0]:arguments,++e==d&&b.resolve.apply(b,f)}).fail(function(){b.reject(arguments)})})(g);return b.promise()}(arguments)},c.prototype.isResolved=function(){return this.status==="rs"},c.prototype.isRejected=function(){return this.status==="rj"},c.prototype.promise=function(){if(arguments.length)switch(typeof arguments[0]){case"undefined":var a={};break;case"object":if(arguments[0]===null)var a={};else var a=arguments[0];break;default:return arguments[0]}else var a={};if(a.isResolved===undefined&&a.isRejected===undefined){a.promise=b(this.promise,this),a.then=b(this.then,this,a),a.done=b(this.done,this,a),a.fail=b(this.fail,this,a),a.always=b(this.always,this,a),a.isResolved=b(this.isResolved,this,a),a.isRejected=b(this.isRejected,this,a);return a}return a.promise()},c.prototype.reject=function(){return this.rejectWith(this,arguments)},c.prototype.resolve=function(){return this.resolveWith(this,arguments)},c.prototype.exec=function(a,b,c,d){if(this.status!=="")return this;this.status=d;for(var e=0;e<b.length;e++)b[e].apply(a,c);return this},c.prototype.resolveWith=function(a){var b=this.resultArgs=arguments.length>1?arguments[1]:[];return this.exec(a,this.doneFuncs,b,"rs")},c.prototype.rejectWith=function(a){var b=this.resultArgs=arguments.length>1?arguments[1]:[];return this.exec(a,this.failFuncs,b,"rj")},c.prototype.done=function(){for(var a=0;a<arguments.length;a++){if(!arguments[a])continue;if(arguments[a].constructor===Array){var b=arguments[a];for(var c=0;c<b.length;c++)this.status==="rs"&&b[c].apply(this,this.resultArgs),this.doneFuncs.push(b[c])}else this.status==="rs"&&arguments[a].apply(this,this.resultArgs),this.doneFuncs.push(arguments[a])}return this},c.prototype.fail=function(a){for(var b=0;b<arguments.length;b++){if(!arguments[b])continue;if(arguments[b].constructor===Array){var c=arguments[b];for(var d=0;d<c.length;d++)this.status==="rj"&&c[d].apply(this,this.resultArgs),this.failFuncs.push(c[d])}else this.status==="rj"&&arguments[b].apply(this,this.resultArgs),this.failFuncs.push(arguments[b])}return this},c.prototype.always=function(){arguments.length>0&&arguments[0]&&this.done(arguments[0]).fail(arguments[0]);return this},c.prototype.then=function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]);return this},a.Deferred=c})(window)
(function(e){function t(e,t,n){return function(){return n?(e.apply(t,arguments),n):e.apply(t,arguments)}}function n(e){return Object.prototype.toString.call(e)==="[object Array]"}function r(e){if(!(this instanceof r))return new r;this.doneFuncs=[],this.failFuncs=[],this.progressFuncs=[],this.resultArgs=null,this.status="pending",this.doneFilter=this.failFilter=this.progressFilter=function(){return function(e){return e}}(),e&&e.apply(this,[this])}r.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:undefined;return e&&typeof e.isResolved=="function"&&typeof e.isRejected=="function"?e.promise():r().resolve(e).promise()}return function(e){var t=r(),n=e.length,i=0,s=new Array(n);for(var o=0;o<e.length;o++)(function(r){e[r].done(function(){s[r]=arguments.length<2?arguments[0]:arguments,++i==n&&t.resolve.apply(t,s)}).fail(function(){t.reject(arguments)})})(o);return t.promise()}(arguments)},r.prototype={isResolved:function(){return this.status==="resolved"},isRejected:function(){return this.status==="rejected"},promise:function(){if(arguments.length)switch(typeof arguments[0]){case"undefined":var e={};break;case"object":if(arguments[0]===null)var e={};else var e=arguments[0];break;default:return arguments[0]}else var e={};return e.isResolved===undefined&&e.isRejected===undefined?(e.promise=t(this.promise,this),e.then=t(this.then,this,e),e.done=t(this.done,this,e),e.fail=t(this.fail,this,e),e.pipe=t(this.pipe,this,e),e.state=t(this.state,this,e),e.progress=t(this.progress,this,e),e.always=t(this.always,this,e),e.isResolved=t(this.isResolved,this,e),e.isRejected=t(this.isRejected,this,e),e):e.promise()},reject:function(){return this.rejectWith(this,arguments)},resolve:function(){return this.resolveWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)},exec:function(e,t,n,r){if(this.status!=="pending")return this;this.status=r,this.status==="pending"?n=this.progressFilter(n):this.status==="rejected"?n=this.failFilter(n):n=this.doneFilter(n);for(var i=0;i<t.length;i++)t[i].apply(e,n);return this},resolveWith:function(e){var t=this.resultArgs=arguments.length>1?arguments[1]:[];return this.exec(e,this.doneFuncs,t,"resolved")},rejectWith:function(e){var t=this.resultArgs=arguments.length>1?arguments[1]:[];return this.exec(e,this.failFuncs,t,"rejected")},notifyWith:function(e){var t=this.resultArgs=arguments.length>1?arguments[1]:[];return this.exec(e,this.progressFuncs,t,"pending")},done:function(){for(var e=0;e<arguments.length;e++){if(!arguments[e])continue;if(n(arguments[e])){var t=arguments[e];for(var r=0;r<t.length;r++)this.status==="resolved"&&this.exec(this,[t[r]],this.resultArgs,this.status),this.doneFuncs.push(t[r])}else this.status==="resolved"&&this.exec(this,[arguments[e]],this.resultArgs,this.status),this.doneFuncs.push(arguments[e])}return this},fail:function(e){for(var t=0;t<arguments.length;t++){if(!arguments[t])continue;if(n(arguments[t])){var r=arguments[t];for(var i=0;i<r.length;i++)this.status==="rejected"&&this.exec(this,[r[i]],this.resultArgs,this.status),this.failFuncs.push(r[i])}else this.status==="rejected"&&this.exec(this,[arguments[t]],this.resultArgs,this.status),this.failFuncs.push(arguments[t])}return this},progress:function(e){if(this.status!=="pending")return;for(var t=0;t<arguments.length;t++){if(!arguments[t])continue;if(n(arguments[t])){var r=arguments[t];for(var i=0;i<r.length;i++)this.progressFuncs.push(r[i])}else this.progressFuncs.push(arguments[t])}return this},always:function(){var e=Array.prototype.slice.call(arguments);return this.done.apply(this,e).fail.apply(this,e)},then:function(){return arguments.length>2&&arguments[2]&&this.progress(arguments[2]),arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),this},state:function(){return this.status},pipe:function(e,t,n){var r=this.promise();return r.doneFilter=typeof e=="function"?e:null,r.failFilter=typeof t=="function"?e:null,r.progressFilter=typeof n=="function"?e:null,r}},e.Deferred=r})(window);
(function(e){function t(e,t,n){return function(){return n?(e.apply(t,arguments),n):e.apply(t,arguments)}}function n(e){if(!(this instanceof n))return new n;this.doneFuncs=[],this.failFuncs=[],this.progressFuncs=[],this.resultArgs=null,this.status="pending",this.doneFilter=this.failFilter=this.progressFilter=function(){return function(e){return e}}(),e&&e.apply(this,[this])}n.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:undefined;return e&&typeof e.isResolved=="function"&&typeof e.isRejected=="function"?e.promise():n().resolve(e).promise()}return function(e){var t=n(),r=e.length,i=0,s=new Array(r);for(var o=0;o<e.length;o++)(function(n){e[n].done(function(){s[n]=arguments.length<2?arguments[0]:arguments,++i==r&&t.resolve.apply(t,s)}).fail(function(){t.reject(arguments)})})(o);return t.promise()}(arguments)},n.prototype={isResolved:function(){return this.status==="resolved"},isRejected:function(){return this.status==="rejected"},promise:function(){if(arguments.length)switch(typeof arguments[0]){case"undefined":var e={};break;case"object":if(arguments[0]===null)var e={};else var e=arguments[0];break;default:return arguments[0]}else var e={};return e.isResolved===undefined&&e.isRejected===undefined?(e.promise=t(this.promise,this),e.then=t(this.then,this,e),e.done=t(this.done,this,e),e.fail=t(this.fail,this,e),e.pipe=t(this.pipe,this,e),e.state=t(this.state,this,e),e.progress=t(this.progress,this,e),e.always=t(this.always,this,e),e.isResolved=t(this.isResolved,this,e),e.isRejected=t(this.isRejected,this,e),e):e.promise()},reject:function(){return this.rejectWith(this,arguments)},resolve:function(){return this.resolveWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)},exec:function(e,t,n,r){if(this.status!=="pending")return this;this.status=r;for(var i=0;i<t.length;i++)t[i].apply(e,n);return this},resolveWith:function(e){var t=this.resultArgs=arguments.length>1?this.doneFilter(arguments[1]):[];return this.exec(e,this.doneFuncs,t,"resolved")},rejectWith:function(e){var t=this.resultArgs=arguments.length>1?this.failFilter(arguments[1]):[];return this.exec(e,this.failFuncs,t,"rejected")},notifyWith:function(e){var t=this.resultArgs=arguments.length>1?this.progressFilter(arguments[1]):[];return this.exec(e,this.progressFuncs,t,"pending")},done:function(){for(var e=0;e<arguments.length;e++){if(!arguments[e])continue;if(arguments[e].constructor===Array){var t=arguments[e];for(var n=0;n<t.length;n++)this.status==="resolved"&&this.exec(this,[t[n]],this.resultArgs,this.status),this.doneFuncs.push(t[n])}else this.status==="resolved"&&this.exec(this,[arguments[e]],this.resultArgs,this.status),this.doneFuncs.push(arguments[e])}return this},fail:function(e){for(var t=0;t<arguments.length;t++){if(!arguments[t])continue;if(arguments[t].constructor===Array){var n=arguments[t];for(var r=0;r<n.length;r++)this.status==="rejected"&&this.exec(this,[n[r]],this.resultArgs,this.status),this.failFuncs.push(n[r])}else this.status==="rejected"&&this.exec(this,[arguments[t]],this.resultArgs,this.status),this.failFuncs.push(arguments[t])}return this},progress:function(e){if(this.status!=="pending")return;for(var t=0;t<arguments.length;t++){if(!arguments[t])continue;if(arguments[t].constructor===Array){var n=arguments[t];for(var r=0;r<n.length;r++)this.progressFuncs.push(n[r])}else this.progressFuncs.push(arguments[t])}return this},always:function(){return arguments.length>0&&arguments[0]&&this.done(arguments[0]).fail(arguments[0]),this},then:function(){return arguments.length>2&&arguments[2]&&this.progress(arguments[2]),arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),this},state:function(){return this.status},pipe:function(e,t,n){var r=this.promise();return r.doneFilter=typeof e=="function"?e:null,r.failFilter=typeof t=="function"?e:null,r.progressFilter=typeof n=="function"?e:null,r}},e.Deferred=n})(window);